---
id: refactor-migration-p1
name: Refactor & Migration - Phase 1 Impact
description: "Refactor & Migration Phase 1: 影響範囲特定フェーズ。影響を受けるモジュール、依存関係、リスク集中領域をマッピングする。結果はPhase 2（移行計画）に引き継ぐ。"
enabled: enabled
strategy: parallel
skills:
  - diff-analyzer         # チーム共通: 差分分析
  - dependency-mapper     # 依存関係可視化
triggers:
  - 大規模リファクタリング
  - バージョン移行（ライブラリ、フレームワーク、言語）
  - アーキテクチャ変更
  - データベーススキーマ移行
  - API互換性を保ちながらの変更
  - レガシーコードの改善
skip_conditions:
  - なし（小さな変更にも影響はある）
members:
  - id: module-analyst
    role: Module Analyst
    description: "モジュール分析担当。影響を受けるモジュール、コンポーネント、ファイルを特定する。"
    enabled: true
  - id: dependency-analyst
    role: Dependency Analyst
    description: "依存関係分析担当。直接的・間接的な依存関係をマッピングし、影響チェーンを特定する。"
    enabled: true
  - id: risk-spotter
    role: Risk Spotter
    description: "リスク発見担当。リスク集中領域、複雑な依存、壊れやすい箇所を特定する。"
    enabled: true
---

# Refactor & Migration - Phase 1: Impact Analysis

## チームミッション

Refactor & MigrationのPhase 1（影響範囲特定）を担当。変更の影響を完全に把握する。

**核心原則:** 影響範囲を完全に把握せずに変更を始めない。リスクを最小化し、常にロールバック可能な状態を維持する。

**鉄の掟:**
```
テストなしにリファクタリングを始めない
段階的でない大規模変更は許されない
```

**出力:** 影響分析結果は Phase 2（refactor-migration-p2）に引き継がれる。

## When to Use

以下の技術的シナリオで使用する:
- 大規模リファクタリング
- バージョン移行（ライブラリ、フレームワーク、言語）
- アーキテクチャ変更
- データベーススキーマ移行
- API互換性を保ちながらの変更
- レガシーコードの改善

**特に以下の場合に使用する:**
- 「このコード、リファクタリングが必要」と感じたとき
- 技術的負債が積み重なり、変更コストが増大している
- 新しいライブラリ・フレームワークへの移行
- パフォーマンス改善のための構造変更
- チーム全体でのコーディング規約統一

**以下の場合でもスキップしてはならない:**
- 「小さなリファクタリングだから計画は不要」と思ったとき（小さな変更にも影響はある）
- 「テストがないが、慎重にやれば大丈夫」と思ったとき（テストは必須）
- 「一度に全部変えた方が早い」と思ったとき（段階的変更が安全）
- 時間的プレッシャーがあるとき（焦りは破壊的変更を生む）

## Output Format

```
SUMMARY: [影響分析サマリー]
CLAIM: [影響範囲の評価]
EVIDENCE: [依存関係マップ、リスク評価]
CONFIDENCE: [0.00-1.00]
RESULT:
## 影響を受けるモジュール
- [モジュール1]: [影響内容]
- [モジュール2]: [影響内容]

## 依存関係
- [依存1]
- [依存2]

## リスク集中領域
- [リスク1]: [詳細]
- [リスク2]: [詳細]
NEXT_STEP: Phase 2（refactor-migration-p2）で移行計画策定
```

## 警告信号 - プロセスの遵守を促す

以下のような考えが浮かんだら、それはSTOPのサイン:
- 「小さなリファクタリングだから影響分析は不要」
- 「テストがないが、慎重にやれば大丈夫」
- 「一度に全部変えた方が早い」
- 「リスクは把握しているから文書化は不要」

**これらすべては: STOP。Phase 1を完了せよ。**

## 人間のパートナーの「やり方が間違っている」シグナル

**以下の方向転換に注意:**
- 「それはどこで使われている？」 - 影響範囲が不明確
- 「テストはどうする？」 - テスト戦略の欠如
- 「ロールバックは？」 - フォールバック計画の欠如

**これらを見たら:** STOP。Phase 1を完了せよ。

## よくある言い訳

| 言い訳 | 現実 |
|--------|------|
| 「小さな変更だから影響分析は不要」 | 小さな変更にも影響はある。把握していないリスクが潜む。 |
| 「テストがなくても慎重にやれば」 | テストは必須。慎重さでは担保できない。 |
| 「一度に変えた方が早い」 | 一括変更はロールバック不可能にする。段階的が安全。 |
| 「リスクは把握している」 | 文書化なき理解は不完全。他者と共有する。 |
