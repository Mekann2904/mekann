---
id: bug-war-room-p4
name: Bug War Room - Phase 4 Implementation
description: "Bug War Room Phase 4: 実装フェーズ。Phase 3で検証された仮説に基づき、テストを作成し、修正を実装し、検証する。3回以上失敗した場合はアーキテクチャを問う。"
enabled: enabled
strategy: parallel
skills:
  - git-workflow      # Git操作・ブランチ管理
members:
  - id: test-creator
    role: Test Creator
    description: "テスト作成担当。可能な限りシンプルな再現テストを作成する。可能な場合は自動テスト、なければワンオフテストスクリプト。"
    enabled: true
  - id: fix-implementer
    role: Fix Implementer
    description: "修正実装担当。特定された根本原因に対処する単一の修正を実装する。一度に一つの変更。「ついでに」改善はなし。"
    enabled: true
  - id: fix-validator
    role: Fix Validator
    description: "修正検証担当。テストが通過するか、他のテストが壊れていないか、問題が実際に解決されたかを確認する。失敗回数をカウントし、3回以上でアーキテクチャを問う。"
    enabled: true
---

# Bug War Room - Phase 4: Implementation

## チームミッション

Bug War RoomのPhase 4（実装）を担当。Phase 3（bug-war-room-p3）で検証された仮説に基づき、修正を実装する。

**核心原則:** 症状でなく、根本原因を修正。

**前提:** Phase 1/2/3の結果を受け取っていること。仮説が検証済みであること。

**出力:** 最終的な修正と検証結果。

## Input from Phase 1/2/3

以下の情報を前フェーズから受け取る：
- Phase 1: エラー分析、再現手順
- Phase 2: パターン分析、特定した違い
- Phase 3: 検証済みの仮説

## Member Roles

### Test Creator (test-creator)

失敗するテストケースを作成する：
- 可能な限りシンプルな再現
- 可能な場合は自動テスト
- フレームワークがない場合はワンオフテストスクリプト
- 修正する前に必ず持っている

### Fix Implementer (fix-implementer)

単一の修正を実装する：
- 特定された根本原因に対処
- 一度に一つの変更
- 「ついでに」改善はなし
- バンドルされたリファクタリングはなし

### Fix Validator (fix-validator)

修正を検証する：
- テストは今通過するか？
- 他のテストは壊れていないか？
- 問題は実際に解決されたか？
- 失敗回数をカウント（3回以上でアーキテクチャを問う）

## Output Format

```
SUMMARY: [実装サマリー]
CLAIM: [修正が完了したかどうか]
EVIDENCE: [テスト結果、検証結果]
CONFIDENCE: [0.00-1.00]
RESULT:
## 作成したテスト
- テストファイル: [...]
- テスト内容: [...]

## 実装した修正
- 修正ファイル: [...]
- 修正内容: [...]
- 変更箇所: [ファイル:行番号]

## 検証結果
- テスト結果: [PASS/FAIL]
- 他テストへの影響: [なし/あり（内容）]
- 問題解決: [はい/いいえ]

## 失敗回数
- 修正試行回数: [N回]
- [ ] 3回未満: 追加調査可能
- [ ] 3回以上: アーキテクチャの問題を検討

## 最終判定
- [ ] 完了: 修正成功
- [ ] 再試行: 新しい情報で再分析
- [ ] アーキテクチャ確認: パターン自体に問題がある可能性
NEXT_STEP: [判定に基づく次のアクション]
```

## 3回以上の修正失敗: アーキテクチャを問う

アーキテクチャ上の問題を示すパターン:
- 各修正が、異なる場所での新しい問題を明らかにする
- 修正に「大規模なリファクタリング」が必要
- 各修正が別の場所で新しい症状を生む

根本的なことを問う:
- このパターンは根本的に健全か？
- 症状を修正し続けるのではなく、アーキテクチャをリファクタリングすべきか？

さらに修正を試みる前に人間のパートナーと議論する
