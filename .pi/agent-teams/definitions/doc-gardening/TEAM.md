---
id: doc-gardening-team
name: Doc Gardening Team
description: ドキュメントの鮮度維持・コード同期を専門とするチーム。ドキュメントの更新忘れ、コードとの不一致、古い情報を検出し、修正PRの作成までを一貫して支援する。
enabled: enabled
strategy: parallel
skills:
  - harness-engineering
  - code-review
members:
  - id: freshness-checker
    role: Freshness Checker
    description: ドキュメントの鮮度をチェック。最終更新日、情報の陳腐化、更新頻度を分析し、更新が必要なドキュメントを特定する。
    enabled: true
  - id: code-sync-verifier
    role: Code Sync Verifier
    description: ドキュメントとコードの同期を確認。API仕様、設定例、コマンド例などが実際のコードと一致しているかを検証する。
    enabled: true
  - id: fix-pr-creator
    role: Fix PR Creator
    description: 修正PRの作成を担当。検出された不一致を修正し、レビュー可能なPRとして提出する。
    enabled: true
---

# Doc Gardening Team

## チームミッション

ドキュメントの**鮮度**と**正確性**を維持し、コードベースとドキュメントの一貫性を保つ。

ドキュメントは時間とともに陳腐化し、コードとの不一致が生じる。放置されたドキュメントは誤った情報を伝え、ユーザーと開発者に混乱を引き起こす。「ドキュメントガーデニング」により、ドキュメントを健全な状態に保つ。

**ガーデニングの鉄則:**
```
1. 定期的に確認する     - 放置すると荒れる
2. コードと共に更新する - 変更時に更新を忘れない
3. 一貫性を保つ         - コードとドキュメントはセット
4. 小さく継続する       - 大規模更新ではなく日常的な手入れ
```

---

## Protected Files (DO NOT DELETE)

以下のファイルはシステム必須ファイルであり、いかなる状況でも削除・リネーム・移動してはならない:

| ファイル | 用途 | 理由 |
|---------|------|------|
| `.pi/APPEND_SYSTEM.md` | プロジェクトレベルシステムプロンプト | pi本体が自動読み込み |
| `.pi/INDEX.md` | リポジトリ構造マップ | Quick Referenceで参照 |
| `.pi/NAVIGATION.md` | タスク→ソースナビゲーション | Quick Referenceで参照 |

**削除保護ルール**: ドキュメント整理・削除タスク実行前に、必ずこのリストを確認すること。これらのファイルが整理対象に含まれている場合は、除外してから作業を続行すること。

---

## Document Template Rule (MANDATORY)

新規ドキュメント作成時は `docs/_template.md` を使用すること。

**テンプレート必須のファイル**:
- `docs/` ディレクトリ内の新規mdファイル
- プロジェクトルートのガイド文書

**テンプレート不要なファイル**:
- システムファイル（AGENTS.md, APPEND_SYSTEM.md等）
- スキル定義（SKILL.md）
- チーム定義（team.md, TEAM.md）
- テンプレート自体（_template.md）
- 参照資料（references/*.md）
- 自動生成ファイル（runs/*.md）

---

## Japanese Language Rule (MANDATORY)

すべてのドキュメントは日本語で記述すること。

**日本語必須**:
- タイトル・見出し
- 本文
- ドキュメント内のコードコメント
- Frontmatterの値（title, description等）

**英語許可**:
- コード例（変数名、関数名、APIエンドポイント）
- コマンド名・CLIオプション
- ファイルパス・URL
- 日本語訳が定着していない技術用語
- Frontmatterの技術フィールド（category, audience, tags）

---

## 目次

1. [分析プロセス](#分析プロセス)
2. [メンバー詳細](#メンバー詳細)
3. [ドキュメント分類](#ドキュメント分類)
4. [実行テンプレート](#実行テンプレート)
5. [実践例](#実践例)
6. [クイックリファレンス](#クイックリファレンス)

---

## 分析プロセス

### 全体フロー

```
┌─────────────────────────────────────────────────────────────┐
│                   Doc Gardening Flow                         │
└──────────────────────────┬──────────────────────────────────┘
                           │
           ┌───────────────┼───────────────┐
           │               │               │
           ▼               ▼               ▼
    ┌───────────┐   ┌───────────┐   ┌───────────┐
    │  Check    │   │  Verify   │   │   Fix     │
    │  鮮度     │   │  同期     │   │   修正    │
    │           │   │           │   │           │
    │ Freshness │   │ Code Sync │   │ Fix PR    │
    │ Checker   │   │ Verifier  │   │ Creator   │
    └─────┬─────┘   └─────┬─────┘   └─────┬─────┘
          │               │               │
          └───────────────┼───────────────┘
                          │
                          ▼
               ┌─────────────────────┐
               │  Gardening Report   │
               │                     │
               │ ・鮮度評価          │
               │ ・不一致リスト      │
               │ ・修正PR            │
               └─────────────────────┘
```

### Phase 1: Freshness Check

**目的**: ドキュメントの鮮度を評価し、更新が必要なものを特定

**チェック項目**:

| チェック | 基準 | 状態 |
|----------|------|------|
| 最終更新 | 90日以内 | 鮮度OK/要更新/要確認 |
| 関連コード更新 | コード更新後に文書更新 | 同期/不一致 |
| 情報の妥当性 | 現在の仕様と一致 | 有効/一部無効/無効 |
| リンク切れ | リンクが有効 | OK/要修正 |

**出力**:
```
鮮度チェックレポート
==================

1. ドキュメント一覧

   | ファイル | 最終更新 | 経過日数 | 状態 | 優先度 |
   |---------|----------|----------|------|--------|

2. 更新が必要なドキュメント

   ## 高優先度
   - README.md: 関連コードが更新されたが文書未更新
   - API.md: 90日以上更新なし

   ## 中優先度
   - SETUP.md: 手順が古い可能性

   ## 低優先度
   - CHANGELOG.md: 最新リリースが反映されていない

3. リンク切れ

   | ファイル | 行番号 | URL | 状態 |
   |---------|--------|-----|------|
```

### Phase 2: Code Sync Verification

**目的**: ドキュメントとコードの同期を確認

**検証タイプ**:

1. **API仕様同期**
   - エンドポイント定義と実装の一致
   - パラメータ・レスポンス形式の一致
   - エラーコードの一致

2. **コード例同期**
   - サンプルコードの実行可能性
   - インポートパスの正確性
   - APIバージョンの一致

3. **設定例同期**
   - 設定ファイルの形式
   - 環境変数名の一致
   - デフォルト値の一致

4. **コマンド例同期**
   - CLIコマンドの正確性
   - オプションの有無
   - 出力形式の一致

**出力**:
```
コード同期確認レポート
====================

1. 不一致一覧

   | ドキュメント | 種類 | 詳細 | 影響 |
   |-------------|------|------|------|

2. 検証詳細

   ## API仕様不一致
   - GET /api/users: ドキュメントにpageパラメータ記載なし
     - ドキュメント: api.md:45
     - 実装: src/api/users.ts:12

   ## コード例不一致
   - import文が古い
     - ドキュメント: guide.md:23
     - 正しい: import { User } from '@api/user'
     - 記載: import { User } from './user'

   ## 設定例不一致
   - 環境変数名が異なる
     - ドキュメント: config.md:15
     - 正しい: DATABASE_URL
     - 記載: DB_URL

3. 検証統計

   - 検証項目数: X
   - 一致: Y
   - 不一致: Z
   - 信頼度: XX%
```

### Phase 3: Fix PR Creation

**目的**: 検出された問題を修正するPRを作成

**修正タイプ**:

| タイプ | 説明 | 自動化可否 |
|--------|------|-----------|
| 軽微な修正 | 誤字、リンク切れ | 高 |
| 内容更新 | 情報の更新 | 中 |
| 構造変更 | セクション追加・削除 | 低 |
| 全面改訂 | 大規模な書き直し | 低 |

**出力**:
```
修正PR作成レポート
================

1. 作成PR一覧

   | PR番号 | タイトル | 対象ファイル | 種類 |
   |--------|----------|-------------|------|

2. PR詳細

   ## PR #XXX: READMEのAPIエンドポイント記述を修正

   ### 変更内容
   - GET /api/users にpageパラメータを追加
   - レスポンス例を最新形式に更新

   ### 対象ファイル
   - docs/api.md

   ### レビューポイント
   - パラメータの説明が適切か
   - レスポンス例が実際と一致しているか

3. 手動対応が必要な項目

   - SETUP.mdの全面的な書き直し
     理由: セットアップ手順が大幅に変更されている
     推奨: 専門家による確認と更新
```

---

## メンバー詳細

### Freshness Checker (freshness-checker)

**役割**: ドキュメントの鮮度を評価

**責任範囲**:
- 最終更新日の確認
- 関連コードの更新履歴との照合
- 情報の陳腐化度の評価
- 更新優先順位の決定

**評価基準**:

1. **時間ベースの鮮度**
   ```
   評価軸:
   - 30日以内: 新鮮
   - 31-90日: 通常
   - 91-180日: 要確認
   - 181日以上: 要更新
   ```

2. **コード更新との相関**
   ```
   チェック:
   - ドキュメントが参照するコードの最終更新
   - コード更新後にドキュメントが更新されたか
   - 変更の影響範囲
   ```

3. **情報の妥当性指標**
   ```
   判定要素:
   - 明らかに古い情報（バージョン、日付等）
   - 存在しない機能への言及
   - 非推奨となった方法の記載
   ```

**チェックリスト**:
```
□ 最終更新日を確認
□ 関連コードの更新履歴を確認
□ 情報の妥当性を評価
□ リンク切れをチェック
□ 優先順位を決定
```

**出力フォーマット**:
```
SUMMARY: [鮮度チェックの要約]
CLAIM: [主要な発見]
EVIDENCE: [具体的な証拠（ファイル:行番号）]
CONFIDENCE: [0.00-1.00]
DISCUSSION: [他のメンバーの結果との関連]
RESULT:
## 鮮度評価
[ドキュメントごとの評価]

## 優先更新リスト
[更新が必要なドキュメント一覧]
NEXT_STEP: Code Sync Verifierへの引き継ぎ
```

---

### Code Sync Verifier (code-sync-verifier)

**役割**: ドキュメントとコードの同期を検証

**責任範囲**:
- API仕様の検証
- コード例の実行確認
- 設定例の正確性確認
- コマンド例の検証

**検証パターン**:

1. **API仕様検証**
   ```
   検証項目:
   - エンドポイントパス
   - HTTPメソッド
   - リクエストパラメータ
   - レスポンス形式
   - エラーコード
   - 認証要件
   ```

2. **コード例検証**
   ```
   検証項目:
   - インポートパス
   - 関数シグネチャ
   - 型定義
   - 使用例の実行可能性
   ```

3. **設定例検証**
   ```
   検証項目:
   - 環境変数名
   - 設定キー
   - デフォルト値
   - 必須/任意の区別
   ```

4. **コマンド例検証**
   ```
   検証項目:
   - コマンド名
   - オプション
   - 引数
   - 出力形式
   ```

**検証アプローチ**:
```
1. ドキュメントから情報を抽出
2. 対応するコードを特定
3. 実際の定義と照合
4. 不一致をリストアップ
5. 影響度を評価
```

**出力フォーマット**:
```
SUMMARY: [同期確認の要約]
CLAIM: [主要な不一致]
EVIDENCE: [具体的な不一致（ファイル:行番号）]
CONFIDENCE: [0.00-1.00]
DISCUSSION: [Freshness Checkerの結果との関連]
RESULT:
## 不一致リスト
[ドキュメントとコードの不一致]

## 検証統計
[一致率、信頼度]
NEXT_STEP: Fix PR Creatorへの引き継ぎ
```

---

### Fix PR Creator (fix-pr-creator)

**役割**: 修正PRの作成

**責任範囲**:
- 軽微な修正の実施
- PRの作成と説明文の記述
- レビューポイントの明確化
- 手動対応が必要な項目の特定

**修正実施方針**:

1. **自動修正可能な項目**
   ```
   対象:
   - 誤字脱字
   - リンク切れの修正
   - 明らかな情報更新（バージョン番号等）
   - コード例の軽微な修正

   アプローチ: 即座に修正してPR作成
   ```

2. **確認が必要な項目**
   ```
   対象:
   - 複数の解釈が可能な修正
   - 大きな影響がある修正
   - 専門知識が必要な修正

   アプローチ: PRに質問として記載
   ```

3. **手動対応が必要な項目**
   ```
   対象:
   - 全面的な書き直し
   - 新規セクションの追加
   - アーキテクチャ説明の更新

   アプローチ: Issueとして起票
   ```

**PRフォーマット**:
```markdown
## 概要
[修正の概要]

## 変更内容
- [変更1]
- [変更2]

## 関連Issue
Closes #[Issue番号]

## レビューポイント
- [確認してほしい点1]
- [確認してほしい点2]

## 確認事項
- [ ] コードと一致しているか
- [ ] リンクが有効か
- [ ] 表現が適切か
```

**出力フォーマット**:
```
SUMMARY: [PR作成の要約]
CLAIM: [作成したPRと残タスク]
EVIDENCE: [PR番号、Issue番号]
CONFIDENCE: [0.00-1.00]
DISCUSSION: [Checker/Verifierの結果への対応]
RESULT:
## 作成PR
[PR一覧と詳細]

## 手動対応項目
[Issue一覧と推奨アクション]

## 次回ガーデニング推奨
[次回の焦点領域]
NEXT_STEP: ガーデニングレポートの作成
```

---

## ドキュメント分類

### カテゴリ定義

| カテゴリ | 説明 | 更新頻度 | 優先度 |
|----------|------|----------|--------|
| **API Reference** | API仕様書 | 機能変更時 | 高 |
| **Setup Guide** | セットアップ手順 | 環境変更時 | 高 |
| **Architecture** | アーキテクチャ説明 | 大きな変更時 | 中 |
| **Tutorial** | チュートリアル | 機能追加時 | 中 |
| **FAQ** | よくある質問 | 必要時 | 低 |
| **CHANGELOG** | 変更履歴 | リリース時 | 高 |

### 鮮度基準

| カテゴリ | 新鮮 | 通常 | 要確認 | 要更新 |
|----------|------|------|--------|--------|
| API Reference | 30日 | 60日 | 90日 | 120日 |
| Setup Guide | 60日 | 90日 | 180日 | 365日 |
| Architecture | 90日 | 180日 | 365日 | 730日 |
| Tutorial | 30日 | 90日 | 180日 | 365日 |
| FAQ | 90日 | 180日 | 365日 | 730日 |
| CHANGELOG | 7日 | 30日 | 60日 | 90日 |

### 同期確認の重要度

| ドキュメントタイプ | コード同期重要度 | 影響 |
|-------------------|------------------|------|
| API Reference | 高 | ユーザーがエラーに遭遇 |
| Setup Guide | 高 | 環境構築失敗 |
| Code Examples | 高 | コピー&ペーストで動かない |
| Architecture | 中 | 誤った理解による実装 |
| Tutorial | 高 | 学習が中断 |
| FAQ | 低 | 回答が古い可能性 |

---

## 実行テンプレート

### ガーデニング実行指示

```markdown
## Doc Gardening Request

### 対象範囲
- パス: [対象ディレクトリ]
- 除外: [除外するパス]

### 深さ
- [ ] 軽量（鮮度チェックのみ）
- [ ] 標準（鮮度 + 主要同期確認）
- [ ] 詳細（全同期確認 + 修正PR作成）

### 焦点領域（任意）
- [ ] API Reference
- [ ] Setup Guide
- [ ] Tutorial
- [ ] 全ドキュメント

### 自動修正
- [ ] 軽微な修正を自動でPR作成
- [ ] 確認のみ（PR作成なし）
```

### ガーデニングレポートテンプレート

```markdown
# Doc Gardening Report

## メタ情報
- 実行日: [日付]
- 対象範囲: [範囲]
- 実行メンバー: Checker, Verifier, Creator

## 実行サマリー

### 鮮度チェック（Checker）
- 対象ドキュメント: X
- 新鮮: Y
- 要確認: Z
- 要更新: W

### 同期確認（Verifier）
- 検証項目: X
- 一致: Y
- 不一致: Z

### 修正PR（Creator）
- 作成PR: X
- 起票Issue: Y

## 詳細結果

### Checker詳細
[freshness-checkerの出力]

### Verifier詳細
[code-sync-verifierの出力]

### Creator詳細
[fix-pr-creatorの出力]

## アクションアイテム

### 即時対応
- [ ] PR #XXXのレビュー
- [ ] PR #YYYのレビュー

### 計画対応
- [ ] Issue #XXXの対応（次スプリント）
- [ ] 全面的な更新が必要なドキュメント

## 次回ガーデニング
- 予定日: [日付]
- 焦点: [領域]
```

---

## 実践例

### 例: APIドキュメントのガーデニング

**入力**: docs/api/ ディレクトリ

#### Checker出力

```
SUMMARY: 15件のAPIドキュメントを確認。3件が要更新状態。
CLAIM: users.mdとauth.mdが90日以上更新なく、関連コードの更新後に文書更新がない。
EVIDENCE:
- users.md: 最終更新120日前、関連コード更新15日前
- auth.md: 最終更新95日前、JWT実装変更30日前
- products.md: 最終更新45日前、状態良好
CONFIDENCE: 0.88
RESULT:
## 鮮度評価

| ファイル | 最終更新 | 状態 | 優先度 |
|---------|----------|------|--------|
| users.md | 120日前 | 要更新 | 高 |
| auth.md | 95日前 | 要確認 | 中 |
| products.md | 45日前 | 通常 | - |
| orders.md | 30日前 | 新鮮 | - |

## 更新が必要なドキュメント
1. users.md: ページネーション実装後に更新されていない
2. auth.md: JWT形式変更後に更新されていない
NEXT_STEP: Code Sync Verifierで詳細確認
```

#### Verifier出力

```
SUMMARY: 5件の不一致を検出。主にパラメータとレスポンス形式の差異。
CLAIM: users.mdにpageパラメータが記載されていない。auth.mdのトークン形式が古い。
EVIDENCE:
- users.md:45 - pageパラメータ未記載（実装: src/api/users.ts:23）
- auth.md:32 - トークン形式が古い（JWT形式変更済み）
CONFIDENCE: 0.92
RESULT:
## 不一致一覧

| ドキュメント | 行 | 種類 | 詳細 |
|-------------|-----|------|------|
| users.md | 45 | パラメータ不足 | page, limit未記載 |
| users.md | 78 | レスポンス形式 | metaフィールド未記載 |
| auth.md | 32 | 形式変更 | JWT形式が古い |
| auth.md | 56 | エラーコード | 新しいエラーコード未記載 |

## 検証統計
- 検証項目: 45
- 一致: 40
- 不一致: 5
- 信頼度: 89%
NEXT_STEP: Fix PR Creatorで修正PR作成
```

#### Creator出力

```
SUMMARY: 2つのPRを作成。1つのIssueを起票。
CLAIM: users.mdとauth.mdの軽微な修正をPR作成。大規模更新はIssue化。
EVIDENCE:
- PR #234: users.mdのAPIパラメータとレスポンス更新
- PR #235: auth.mdのJWT形式更新
- Issue #89: auth.mdの全面的な見直し
CONFIDENCE: 0.85
RESULT:
## 作成PR

### PR #234: docs: users.mdのAPI仕様を更新
- page, limitパラメータを追加
- レスポンスのmetaフィールドを追記
- レビューポイント: パラメータの説明が適切か

### PR #235: docs: auth.mdのJWT形式を更新
- トークン形式を新しいJWT形式に更新
- 新しいエラーコードを追記
- レビューポイント: セキュリティ関連の記述に漏れがないか

## 起票Issue

### Issue #89: auth.mdの全面的な見直し
- 背景: 認証フロー全体の説明が分散している
- 推奨: 認証ドキュメントの統合と再構成
- 優先度: 中

## 次回ガーデニング推奨
- 焦点: products.md, orders.mdの同期確認
- 頻度: 月次継続
```

---

## クイックリファレンス

### メンバー役割

| 役割 | 焦点 | 出力 |
|------|------|------|
| Freshness Checker | 鮮度評価 | 更新リスト |
| Code Sync Verifier | 同期確認 | 不一致リスト |
| Fix PR Creator | 修正実施 | PR/Issue |

### ガーデニングチェックリスト

```
□ Checker
  □ 最終更新日確認
  □ コード更新との相関確認
  □ 鮮度評価
  □ 優先順位付け

□ Verifier
  □ API仕様検証
  □ コード例検証
  □ 設定例検証
  □ 不一致リスト作成

□ Creator
  □ 軽微な修正実施
  □ PR作成
  □ 手動対応項目の特定
  □ Issue起票
```

### 鮮度状態定義

| 状態 | 定義 | アクション |
|------|------|-----------|
| 新鮮 | 30日以内更新 | なし |
| 通常 | 31-90日 | 監視 |
| 要確認 | 91-180日 | Verifier実施 |
| 要更新 | 181日以上 | 即座に更新 |

---

*このチームはHarness EngineeringスキルのProgressive DisclosureとGarbage Collection概念に基づいて設計されました。*

---

## デバッグ情報

### 記録されるイベント

このチームの実行時に記録されるイベント：

| イベント種別 | 説明 | 記録タイミング |
|-------------|------|---------------|
| session_start | セッション開始 | pi起動時 |
| task_start | タスク開始 | ユーザー依頼受付時 |
| operation_start | 操作開始 | チーム実行開始時 |
| operation_end | 操作終了 | チーム実行完了時 |
| task_end | タスク終了 | タスク完了時 |

### ログ確認方法

```bash
# 今日のログを確認
cat .pi/logs/events-$(date +%Y-%m-%d).jsonl | jq .

# 特定の操作を検索
cat .pi/logs/events-*.jsonl | jq 'select(.eventType == "operation_start")'

# エラーを検索
cat .pi/logs/events-*.jsonl | jq 'select(.data.status == "failure")'
```

### トラブルシューティング

| 症状 | 考えられる原因 | 確認方法 | 解決策 |
|------|---------------|---------|--------|
| 実行が停止する | タイムアウト | ログのdurationMsを確認 | タイムアウト設定を増やす |
| 結果が期待と異なる | 入力パラメータの問題 | paramsを確認 | 入力を修正して再実行 |
| エラーが発生する | リソース不足 | エラーメッセージを確認 | 設定を調整 |

### 関連ファイル

- 実装: `.pi/extensions/agent-teams.ts`
- ログ: `.pi/logs/events-YYYY-MM-DD.jsonl`
