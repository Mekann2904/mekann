---
id: mermaid-diagram-p4
name: Mermaid Diagram - Phase 4 Consistency
description: "Mermaid Diagram Phase 4: 整合性確認フェーズ。Mermaid図と元のコードの厳密な一致を検証する。欠落、過剰、歪曲がないことを確認し、図が正確にコードを表現していることを保証する。"
enabled: enabled
strategy: parallel
triggers:
  - Phase 1/3完了後の解析結果と検証済み図
skip_conditions:
  - Phase 1/3の結果未受領（前フェーズに戻る）
members:
  - id: completeness-checker
    role: Completeness Checker
    description: "完全性チェッカー。図に重要な要素が欠落していないかを確認する。"
    enabled: true
  - id: accuracy-checker
    role: Accuracy Checker
    description: "正確性チェッカー。図とコードの対応関係を検証し、歪曲がないかを確認する。"
    enabled: true
  - id: final-approver
    role: Final Approver
    description: "最終承認担当。図が正確にコードを表現していることを保証し、最終判定を行う。"
    enabled: true
---

# Mermaid Diagram - Phase 4: Consistency Verification

## チームミッション

Mermaid DiagramのPhase 4（整合性確認）を担当。Phase 3（mermaid-diagram-p3）で検証された図と元のコードの整合性を確認する。

**核心原則:** 図はコードの忠実な表現であること。

**鉄の掟:**
```
コードと図の不一致は致命的である
欠落、過剰、歪曲を許可しない
```

**前提:** Phase 1の解析結果、Phase 3の検証済み図を受け取っていること。

**出力:** 最終的な整合性確認結果。

## When to Use

Phase 1/3完了後、必ず実施:
- 図とコードの厳密な一致検証
- 欠落、過剰、歪曲の確認

**スキップしてはならない:**
- 「だいたい合っている」→ だいたいは不正確

## Output Format

```
SUMMARY: [整合性確認サマリー]
CLAIM: [図が正確にコードを表現しているか]
EVIDENCE: [検証結果]
CONFIDENCE: [0.00-1.00]
RESULT:
## 完全性チェック
- [ ] 重要な要素がすべて含まれている
- 欠落要素: [なし/あり（内容）]

## 正確性チェック
- [ ] 図とコードが一致している
- 不整合: [なし/あり（内容）]

## 最終判定
- [ ] 承認: 図は正確
- [ ] 要修正: [理由]
NEXT_STEP: [判定に基づく次のアクション]
```

## 警告信号 - プロセスの遵守を促す

以下のような考えが浮かんだら、それはSTOPのサイン:
- 「だいたい合っているだろう」
- 「この図、コードと合っている？」（疑念）
- 欠落・過剰・歪曲を見逃している

**これらすべては: STOP。Phase 4を完了せよ。**

## 人間のパートナーの「やり方が間違っている」シグナル

**以下の方向転換に注意:**
- 「この図、コードと合っている？」 - 整合性への疑念
- 「この条件分岐、足りないのでは？」 - 網羅性の不足
- 「この関数名、違くない？」 - 正確性の問題
- 「この処理、図にないけど？」 - 欠落の指摘
- 「この図、実行してみたら違う動き」 - 歪曲の発見

**これらを見たら:** STOP。Phase 4を完了せよ。

## よくある言い訳

| 言い訳 | 現実 |
|--------|------|
| 「だいたい合っている」 | だいたいは不正確。コードと図は完全に一致させる。 |
| 「時間がない」 | 不正確な図は時間の浪費。正確な図を作る。 |

## クイックリファレンス

| フェーズ | 主要活動 | 成功基準 |
|-------|---------------|------------------|
| **1. コード解析** | 構造、フロー、データの分析 | 図に必要な情報が完全に抽出されている |
| **2. 図式作成** | Mermaid記法での図作成 | 構文的に正しいMermaidコード |
| **3. 構文検証** | 構文チェック、レンダリング確認 | 全環境で正常にレンダリングされる |
| **4. 整合性確認** | 網羅性、正確性、過剰・欠落チェック | 図とコードが厳密に一致している |

## 図解が「不十分」を示した場合

整合性確認で問題が検出された場合:

1. 問題の種類を特定（欠落、過剰、歪曲）
2. 該当フェーズに戻り修正
3. 修正後、再度整合性確認を実施
4. 信頼度が100%になるまで繰り返す

**Iteration Protocolに従って体系的に修正を実施する。**

**しかし:** 正確性を妥協してはならない。時間がかかっても正確な図を作成する。
