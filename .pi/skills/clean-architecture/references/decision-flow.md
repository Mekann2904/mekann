# 設計判断フローチャート

## コンポーネント分割の判断

```
新しいクラスを追加する場合
         │
         ▼
┌─────────────────────────┐
│ 既存コンポーネントと     │
│ 変更理由が同じか？       │
└───────────┬─────────────┘
            │
     ┌──────┴──────┐
     Yes          No
     │             │
     ▼             ▼
┌──────────┐  ┌─────────────────────────┐
│ 既存に   │  │ 新しいコンポーネントを作成│
│ 追加する │  └───────────┬─────────────┘
└──────────┘              │
                          ▼
              ┌─────────────────────────┐
              │ 他のコンポーネントで     │
              │ 再利用する可能性は？     │
              └───────────┬─────────────┘
                          │
                   ┌──────┴──────┐
                   高い          低い
                   │             │
                   ▼             ▼
          ┌─────────────┐  ┌─────────────┐
          │ 再利用可能な │  │ 機能固有の   │
          │ コンポーネント│  │ コンポーネント│
          │ として独立   │  │ として独立   │
          └─────────────┘  └─────────────┘
```

---

## 依存関係の判断

```
AからBへの依存を追加する場合
         │
         ▼
┌─────────────────────────┐
│ 循環依存が発生するか？   │
└───────────┬─────────────┘
            │
     ┌──────┴──────┐
     Yes          No
     │             │
     ▼             ▼
┌──────────────┐  ┌─────────────────────────┐
│ 依存関係逆転  │  │ BはAより安定しているか？│
│ インターフェース│  └───────────┬─────────────┘
│ を抽出する   │              │
└──────────────┘       ┌──────┴──────┐
                       Yes          No
                       │             │
                       ▼             ▼
              ┌─────────────┐  ┌─────────────┐
              │ 依存OK      │  │ 依存NG      │
              │ (SDP満足)   │  │ (SDP違反)   │
              └─────────────┘  │ 依存方向を  │
                               │ 逆にするか  │
                               │ インターフェース│
                               │ を抽出      │
                               └─────────────┘
```

---

## 開発フェーズの判断

```
現在の開発フェーズを判定
         │
         ▼
┌─────────────────────────┐
│ 仕様は安定しているか？   │
│ （頻繁に大きな変更がない）│
└───────────┬─────────────┘
            │
     ┌──────┴──────┐
     No           Yes
     │             │
     ▼             ▼
┌──────────────┐  ┌──────────────┐
│ 【開発初期】  │  │ 【開発中盤以降】│
│              │  │              │
│ 重視: CCP    │  │ 重視: REP    │
│ + CRP        │  │ + CRP        │
│              │  │              │
│ 変更を局所化  │  │ 再利用性向上  │
│ 大きすぎる    │  │ 共通部分を    │
│ コンポーネント│  │ ライブラリ化  │
│ は避ける     │  │              │
└──────────────┘  └──────────────┘
```

---

## パッケージ構造の判断

```
パッケージをどう切るか
         │
         ▼
┌─────────────────────────┐
│ レイヤー別か             │
│ コンポーネント別か       │
└───────────┬─────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ Package by Layer（非推奨）           │
│ - service/, repository/, domain/    │
│ - 変更時に複数パッケージを修正       │
│ - 凝集度が低い                       │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ Package by Component（推奨）         │
│ - order/, user/, payment/           │
│ - 各コンポーネントに必要なものを集約 │
│ - 凝集度が高い                       │
│ - 変更が局所的                       │
└─────────────────────────────────────┘
```

---

## 詳細をプラグイン化する判断

```
この実装はプラグイン化すべきか？
         │
         ▼
┌─────────────────────────┐
│ これは「詳細」か？       │
│ - UI                     │
│ - データベース            │
│ - フレームワーク          │
│ - 外部API                │
│ - ファイルシステム        │
└───────────┬─────────────┘
            │
     ┌──────┴──────┐
     Yes          No
     │             │
     ▼             ▼
┌──────────────┐  ┌──────────────┐
│ プラグイン化  │  │ コアとして   │
│              │  │ 配置         │
│ 手順:        │  │              │
│ 1. インター  │  │ ビジネス     │
│    フェースを │  │ ロジック     │
│    コアに定義 │  │ として       │
│ 2. 実装を    │  │ 扱う         │
│    外部に配置 │  │              │
└──────────────┘  └──────────────┘
```

---

## クイック診断

### コンポーネントが大きすぎる兆候

- [ ] 変更理由が3つ以上ある
- [ ] 一部だけ使われるクラスが含まれる
- [ ] 再デプロイの影響範囲が広い
- [ ] テストが遅い

### 依存関係に問題がある兆候

- [ ] 変更が連鎖的に広がる
- [ ] ビルド順序が決まらない
- [ ] 抽象クラスが具象クラスに依存している
- [ ] ビジネスロジックがUIやDBを直接参照している

### アーキテクチャが「叫んで」いない兆候

- [ ] トップディレクトリがフレームワーク名
- [ ] ユースケースがどこにあるかわからない
- [ ] ディレクトリ名が技術用語ばかり
